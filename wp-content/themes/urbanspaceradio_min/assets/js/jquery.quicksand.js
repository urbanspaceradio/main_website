!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=function(e,i){return void 0===i&&(i="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(i),i}:t(jQuery)}(function(t){var e=function(t){var e=t.clone(!0,!0),i=t.find("canvas");i.length&&e.find("canvas").each(function(t){this.getContext("2d").drawImage(i.get(t),0,0)});return e};t.fn.quicksand=function(i,s){var a,o={duration:750,easing:"swing",attribute:"data-id",adjustHeight:"call",adjustWidth:!1,useScaling:!1,enhancement:function(t){},selector:"> *",atomic:!1,dx:0,dy:0,maxWidth:0,retainExisting:!0};t.extend(o,s),void 0===t.transform&&(o.useScaling=!1),"function"==typeof arguments[1]?a=arguments[1]:(arguments[2],a=arguments[2]);var n=this;return this.each(function(s){var f,r,l=[];r="function"==typeof o.attribute?t(i):e(t(i).filter("["+o.attribute+"]"));var h,c,p=t(this),d=t(this).css("height"),u=t(this).css("width"),y=!1,m=!1,g=t(p).offset(),b=[],v=t(this).find(o.selector),x=t(v).innerWidth();if(navigator.userAgent.match(/msie [6]/i))p.html("").append(r);else{var w=0,j=function(){if(t(this).css("margin","").css("position","").css("top","").css("left","").css("opacity",""),!w){if(w=1,!o.atomic){var e=p.find(o.selector);if(o.retainExisting){var i=t([]);S.find(o.selector).each(function(s){var a=t([]);if("function"==typeof o.attribute){var n=o.attribute(t(this));e.each(function(){if(o.attribute(this)==n)return a=t(this),!1})}else a=e.filter("["+o.attribute+'="'+t(this).attr(o.attribute)+'"]');a.length>0&&(i=i.add(a),0===s?p.prepend(a):a.insertAfter(p.find(o.selector).get(s-1)))}),e.not(i).remove()}else p.prepend(S.find(o.selector)),e.remove();y&&p.css("height",h),m&&p.css("width",u)}o.enhancement(p),"function"==typeof a&&a.call(n)}"auto"===o.adjustHeight&&p.css("height","auto"),"auto"===o.adjustWidth&&p.css("width","auto")},W=p.offsetParent(),F=W.offset();"relative"==W.css("position")?"body"!=W.get(0).nodeName.toLowerCase()&&(F.top+=parseFloat(W.css("border-top-width"))||0,F.left+=parseFloat(W.css("border-left-width"))||0):(F.top-=parseFloat(W.css("border-top-width"))||0,F.left-=parseFloat(W.css("border-left-width"))||0,F.top-=parseFloat(W.css("margin-top"))||0,F.left-=parseFloat(W.css("margin-left"))||0),isNaN(F.left)&&(F.left=0),isNaN(F.top)&&(F.top=0),F.left-=o.dx,F.top-=o.dy,!1!==o.adjustHeight&&p.css("height",t(this).height()),!1!==o.adjustWidth&&p.css("width",t(this).width()),v.each(function(e){b[e]=t(this).offset()}),t(this).stop();var q=0,H=0;v.each(function(e){t(this).stop();var i=t(this).get(0);"absolute"==i.style.position?(q=-o.dx,H=-o.dy):(q=o.dx,H=o.dy),i.style.position="absolute",i.style.margin="0",o.adjustWidth||(i.style.width=x+"px"),i.style.top=b[e].top-parseFloat(i.style.marginTop)-F.top+H+"px",i.style.left=b[e].left-parseFloat(i.style.marginLeft)-F.left+q+"px",o.maxWidth>0&&b[e].left>o.maxWidth&&(i.style.display="none")});var S=e(t(p)),N=S.get(0);if(N.innerHTML="",N.setAttribute("id",""),N.style.height="auto",N.style.width=p.width()+"px",S.append(r),S.insertBefore(p),S.css("opacity",0),N.style.zIndex=-1,N.style.margin="0",N.style.position="absolute",N.style.top=g.top-F.top+"px",N.style.left=g.left-F.left+"px","dynamic"===o.adjustHeight?p.animate({height:S.height()},o.duration,o.easing):"call"===o.adjustHeight&&(h=S.height(),parseFloat(d)<parseFloat(h)?p.css("height",h):y=!0),"dynamic"===o.adjustWidth?p.animate({width:S.width()},o.duration,o.easing):"call"===o.adjustWidth&&(c=S.width(),parseFloat(u)<parseFloat(c)?p.css("width",c):m=!0),v.each(function(e){var i=[];"function"==typeof o.attribute?(f=o.attribute(t(this)),r.each(function(){if(o.attribute(this)==f)return i=t(this),!1})):i=r.filter("["+o.attribute+'="'+t(this).attr(o.attribute)+'"]'),i.length?o.useScaling?l.push({element:t(this),dest:i,style:{top:t(this).offset().top,left:t(this).offset().left,opacity:""},animation:{top:i.offset().top-F.top,left:i.offset().left-F.left,opacity:1,transform:"scale(1.0)"}}):l.push({element:t(this),dest:i,style:{top:t(this).offset().top,left:t(this).offset().left,opacity:""},animation:{top:i.offset().top-F.top,left:i.offset().left-F.left,opacity:1}}):o.useScaling?l.push({element:t(this),style:{top:t(this).offset().top,left:t(this).offset().left,opacity:""},animation:{opacity:"0.0",transform:"scale(0.0)"}}):l.push({element:t(this),style:{top:t(this).offset().top,left:t(this).offset().left,opacity:""},animation:{opacity:"0.0"}})}),r.each(function(i){var s,a=[],n=[];if("function"==typeof o.attribute?(f=o.attribute(t(this)),v.each(function(){if(o.attribute(this)==f)return a=t(this),!1}),r.each(function(){if(o.attribute(this)==f)return n=t(this),!1})):(a=v.filter("["+o.attribute+'="'+t(this).attr(o.attribute)+'"]'),n=r.filter("["+o.attribute+'="'+t(this).attr(o.attribute)+'"]')),0===a.length&&n.length>0){s=o.useScaling?{opacity:"1.0",transform:"scale(1.0)"}:{opacity:"1.0"};var h=e(n),c=h.get(0);c.style.position="absolute",c.style.margin="0",o.adjustWidth||(c.style.width=x+"px"),c.style.top=n.offset().top-F.top+"px",c.style.left=n.offset().left-F.left+"px",h.css("opacity",0),o.useScaling&&h.css("transform","scale(0.0)"),h.appendTo(p),(0===o.maxWidth||n.offset().left<o.maxWidth)&&l.push({element:t(h),dest:n,animation:s})}}),S.remove(),o.atomic){for($toDelete=p.find(o.selector),p.prepend(S.find(o.selector)),s=0;s<l.length;s++)if(l[s].dest&&l[s].style){var A=l[s].dest,L=A.offset();A.css({position:"relative",top:l[s].style.top-L.top,left:l[s].style.left-L.left}),A.animate({top:"0",left:"0"},o.duration,o.easing,j)}else l[s].element.animate(l[s].animation,o.duration,o.easing,j);$toDelete.remove()}else for(o.enhancement(p),s=0;s<l.length;s++)l[s].element.animate(l[s].animation,o.duration,o.easing,j)}})}});