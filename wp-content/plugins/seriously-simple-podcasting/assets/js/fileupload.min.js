jQuery(document).ready(function(a){function t(e){a(".peek-a-bar").hide().remove(),new a.peekABar({padding:"1em",animation:{type:"fade",duration:1e3},cssClass:"ssp-notification-bar",backgroundColor:"#4aa3df"}).show({html:e})}var s;"undefined"!=typeof upload_credentials&&((s=new plupload.Uploader({runtimes:"html5",browse_button:"ssp_select_file",multi_selection:!1,container:"ssp_upload_container",url:upload_credentials.castos_api_url+"files"})).init(),s.bind("Init",function(){a("#ssp_upload_notification").remove()}),s.bind("FilesAdded",function(e,i){var o,a=i[0];i=(o=a).type.split("/"),o=!1,"audio"!==i[0]&&"video"!==i[0]||(o=!0),o?(t('Uploading file to Castos Hosting. You can continue editing this post while the file uploads. <b id="ssp_upload_progress"></b>'),s.start()):(t("You have selected an invalid file type, please select a valid audio or video file."),s.removeFile(a))}),s.bind("BeforeUpload",function(e,i){i=i.name.replace(/[,\/#!$%\^&\*;:{}=\-_`'~()+"|? ]/g," ").replace(/\s{1,}/g,"-"),i={token:upload_credentials.castos_api_token,episode_id:upload_credentials.castos_episode_id,file_name:i};s.settings.multipart_params=i}),s.bind("Error",function(e,i){alert("Error #"+i.code+": "+i.message)}),s.bind("UploadProgress",function(e,i){a("#ssp_upload_progress").html(i.percent+"%"),100===i.percent&&t("Processing Castos Hosting file.")}),s.bind("FileUploaded",function(e,i,o){t("Uploading file to Castos Hosting Complete.");o=JSON.parse(o.response);200===o.status&&(i=o.file,a("#podmotor_file_id").val(i.id),a("#filesize_raw").val(i.file_size),a("#filesize").val(plupload.formatSize(i.file_size)),a("#duration").val(i.file_duration),a("#upload_audio_file").val(i.file_path),a(".peek-a-bar").fadeOut(5e3))}),s.bind("UploadComplete",function(e,i){a(".peek-a-bar").fadeOut(5e3)}))});