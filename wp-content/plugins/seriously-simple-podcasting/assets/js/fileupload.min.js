jQuery(document).ready(function(o){function t(e){o(".peek-a-bar").hide().remove(),new o.peekABar({padding:"1em",animation:{type:"fade",duration:1e3},cssClass:"ssp-notification-bar",backgroundColor:"#4aa3df"}).show({html:e})}var s;"undefined"!=typeof upload_credentials&&((s=new plupload.Uploader({runtimes:"html5",browse_button:"ssp_select_file",multi_selection:!1,container:"ssp_upload_container",url:upload_credentials.castos_api_url+"files"})).init(),s.bind("Init",function(){o("#ssp_upload_notification").remove()}),s.bind("FilesAdded",function(e,i){var a,o=i[0];i=(a=o).type.split("/"),a=!1,"audio"!==i[0]&&"video"!==i[0]||(a=!0),a?(t('Uploading file to Castos Hosting. You can continue editing this post while the file uploads. <b id="ssp_upload_progress"></b>'),s.start()):(t("You have selected an invalid file type, please select a valid audio or video file."),s.removeFile(o))}),s.bind("BeforeUpload",function(e,i){i=i.name.replace(/[,\/#!$%\^&\*;:{}=\-_`'~()+"|? ]/g," ").replace(/\s{1,}/g,"-"),i={token:upload_credentials.castos_api_token,episode_id:upload_credentials.castos_episode_id,file_name:i};s.settings.multipart_params=i}),s.bind("Error",function(e,i){let a=i.message;try{let e=JSON.parse(i.response);"object"==typeof e&&e.hasOwnProperty("message")&&(a=e.message)}catch(e){}alert("Error: "+a)}),s.bind("UploadProgress",function(e,i){o("#ssp_upload_progress").html(i.percent+"%"),100===i.percent&&t("Processing Castos Hosting file.")}),s.bind("FileUploaded",function(e,i,a){t("Uploading file to Castos Hosting Complete.");a=JSON.parse(a.response);200===a.status&&(i=a.file,o("#podmotor_file_id").val(i.id),o("#filesize_raw").val(i.file_size),o("#filesize").val(plupload.formatSize(i.file_size)),o("#duration").val(i.file_duration),o("#upload_audio_file").val(i.file_path),o(".peek-a-bar").fadeOut(5e3))}),s.bind("UploadComplete",function(e,i){o(".peek-a-bar").fadeOut(5e3)}))});